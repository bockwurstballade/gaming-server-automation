- name: Check if cod1 systemd service exists
  become: true
  become_user: root
  ansible.builtin.systemd:
    name: cod1
  register: service_check
  ignore_errors: yes
  check_mode: yes

- name: Stop cod1 service if it exists
  become: true
  become_user: root
  ansible.builtin.systemd:
    name: cod1
    state: stopped
  when: service_check.status is defined

- name: Ensure gcc libraries for CoD Server are downloaded
  ansible.builtin.include_role:
    name: roles/utils/gdrive/download
  vars:
    utils_gdrive_download__file_id: "{{ games_cod1_server_installed__gcc_file_id }}"
    utils_gdrive_download__file_name: "{{ games_cod1_server_installed__gcc_file_name }}"
    utils_gdrive_download__temp_mode: "{{ games_cod1_server_installed__temp_mode | default(true) }}"

- name: Ensure Call of Duty 1 Server is installed
  become: true
  become_user: root
  block:
  - name: Ensure unzip is installed
    ansible.builtin.package:
      name: unzip
      state: present

  - name: "Ensure {{ games_cod1_server_installed__gcc_file_name }} is extracted to /lib/"
    ansible.builtin.unarchive:
      src: "{{ (utils_gdrive_download__temp_dir.path, games_cod1_server_installed__gcc_file_name) | ansible.builtin.path_join }}"
      dest: "{{ [games_cod1_server_installed__lib_dir] | ansible.builtin.path_join }}"
      mode: '0775'
      remote_src: true

  - name: Ensure Service User Group exists
    ansible.builtin.group:
      name: "{{ games_cod1_server_installed__group_name }}"
      state: present

  - name: Ensure "{{ games_cod1_server_installed__user_name }}" user exists
    ansible.builtin.user:
      name: "{{ games_cod1_server_installed__user_name }}"
      state: present
      group: "{{ games_cod1_server_installed__group_name }}"
      password: "{{ games_cod1_server_installed__user_password }}"
      shell: /bin/bash # Does not need interactive login
      home: "/home/{{ games_cod1_server_installed__user_name }}"
      create_home: true  # Does not need home directory

  - name: Add i386 architecture
    ansible.builtin.command: dpkg --add-architecture i386
    register: dpkg_result
    changed_when: dpkg_result.rc == 0  # Only mark as changed if successful
    failed_when: dpkg_result.rc != 0   # Fail if the command returns an error

  - name: Update apt cache
    ansible.builtin.apt:
      update_cache: yes
    when: dpkg_result.changed # Only run if the architecture was added

  - name: Install 32-bit libraries
    ansible.builtin.apt:
      name:
        - libc6:i386
        - libstdc++6:i386
      state: present # Ensures the packages are installed

  - name: Ensure CoD1 Server directory exists
    ansible.builtin.file:
      path:  "{{ games_cod1_server_installed__directory }}"
      state: directory
      mode: '0750'
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"

  - name: Ensure CoD1 home directory exists
    ansible.builtin.file:
      path:  "{{ games_cod1_server_installed__home_directory }}"
      state: directory
      mode: '0750'
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"

  - name: Ensure CoD1 home main directory exists
    ansible.builtin.file:
      path:  "{{ [games_cod1_server_installed__home_directory, 'main'] | ansible.builtin.path_join }}"
      state: directory
      mode: '0750'
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"


  - name: Ensure LD_LIBRARY_PATH is set in .bashrc for cod1
    ansible.builtin.lineinfile:
      path: /home/cod1/.bashrc
      regexp: '^export LD_LIBRARY_PATH=.*$'
      line: 'export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/lib:/games/cod1"'
      state: present
      owner: cod1
      group: cod1

  - name: "Ensure {{ games_cod1_server_installed__gcc_file_name }} is extracted to {{ games_cod1_server_installed__directory }}"
    ansible.builtin.unarchive:
      src: "{{ (utils_gdrive_download__temp_dir.path, games_cod1_server_installed__gcc_file_name) | ansible.builtin.path_join }}"
      dest: "{{ [games_cod1_server_installed__directory] | ansible.builtin.path_join }}"
      mode: '0775'
      remote_src: true

  - name: Ensure CoD CD Setup Data is downloaded
    ansible.builtin.include_role:
      name: roles/utils/gdrive/download
    vars:
      utils_gdrive_download__file_id: "{{ games_cod1_server_installed__setup_data_file_id }}"
      utils_gdrive_download__file_name: "{{ games_cod1_server_installed__setup_data_file_name }}"
      utils_gdrive_download__temp_mode: "{{ games_cod1_server_installed__temp_mode | default(true) }}"

  - name: "Ensure CoD CD Setup Data is extracted to {{ games_cod1_server_installed__directory }}"
    ansible.builtin.unarchive:
      src: "{{ (utils_gdrive_download__temp_dir.path, games_cod1_server_installed__setup_data_file_name) | ansible.builtin.path_join }}"
      dest: "{{ [games_cod1_server_installed__directory] | ansible.builtin.path_join }}"
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0775'
      remote_src: true

  - name: Ensure CoD 1.5 Linux Server Base is downloaded
    ansible.builtin.include_role:
      name: roles/utils/gdrive/download
    vars:
      utils_gdrive_download__file_id: "{{ games_cod1_server_installed__one_five_server_base_file_id }}"
      utils_gdrive_download__file_name: "{{ games_cod1_server_installed__one_five_server_base_file_name }}"
      utils_gdrive_download__temp_mode: "{{ games_cod1_server_installed__temp_mode | default(true) }}"

  - name: "Ensure CoD 1.5 Linux Server Base is extracted to {{ games_cod1_server_installed__directory }}"
    ansible.builtin.unarchive:
      src: "{{ (utils_gdrive_download__temp_dir.path, games_cod1_server_installed__one_five_server_base_file_name) | ansible.builtin.path_join }}"
      dest: "{{ [games_cod1_server_installed__directory] | ansible.builtin.path_join }}"
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0775'
      remote_src: true

  - name: Ensure CoD 1.5b Linux Server Base is downloaded
    ansible.builtin.include_role:
      name: roles/utils/gdrive/download
    vars:
      utils_gdrive_download__file_id: "{{ games_cod1_server_installed__one_fiveb_server_base_file_id }}"
      utils_gdrive_download__file_name: "{{ games_cod1_server_installed__one_fiveb_server_base_file_name }}"
      utils_gdrive_download__temp_mode: "{{ games_cod1_server_installed__temp_mode | default(true) }}"

  - name: "Ensure CoD 1.5b Linux Server Base is extracted to {{ games_cod1_server_installed__directory }}"
    ansible.builtin.unarchive:
      src: "{{ (utils_gdrive_download__temp_dir.path, games_cod1_server_installed__one_fiveb_server_base_file_name) | ansible.builtin.path_join }}"
      dest: "{{ [games_cod1_server_installed__directory] | ansible.builtin.path_join }}"
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0775'
      remote_src: true

  - name: Create autoexec_mp.cfg with map configuration
    ansible.builtin.copy:
      dest: "{{ games_cod1_server_installed__directory }}/main/autoexec_mp.cfg"
      content: |
        map mp_harbor
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0644'

  - name: Ensure server.cfg exists with correct content
    ansible.builtin.copy:
      content: |
        //Initialisieren Read Only Vars:

        //Punkbuster
        set sv_punkbuster "1"
        pb_sv_enable
        wait 5

        //IP des Servers
        set net_ip "http://152.5"

        //Port des Servers
        set net_port "28950"

        //Spiel loggen ( 0 = aus 1 = an )
        set logfile "1"

        //0 - gepuffertes Loggen (zeitversetzt)
        //1 - sofortiges Loggen
        set g_logsync "1"

        //Name der Log-Datei
        set g_log "games_mp.log"

        //Oeffentliche Server-Informationen:

        //Name des Servers
        set sv_hostname "Jesters of Death Deathmatch Server"

        //Administrator des Servers
        sets .Admin "baereneule | dafrk | bockwurstballade"

        //E-Mail-Adresse des Admins
        sets .Email ""

        //IRC-Channels
        sets .IRC "#n/a"

        //Homepage
        sets .Url ""

        //Standort des Servers
        sets .Location "Germany"

        //Begruessung
        set scr_motd "discord.gg/ENfFFKPf2H"

        //***

        //Passwoerter

        //RCON-Passwort
        set rconPassword "JoD1234!"

        //NUR EINS VON BEIDEN VERWENDEN!
        //Server-Passwort
        set g_password ""

        //Privates Passwort
        set sv_privatepassword ""

        //***

        //Allgemeine Servereinstellungen:

        //Maximale Spieleranzahl
        set sv_maxclients "32"

        //Private Clients
        set sv_privateClients ""

        //Maximale Datenrate
        set sv_maxRate "25000"

        //Mindest-Ping der Clients (0 = egal)
        set sv_minPing ""

        //Max-Ping der Clients (0 = egal)
        set sv_maxPing "120"

        //Antilag-Feature
        set g_antilag "1"

        //Friendly Fire (0 = an, 1 = aus,2 = reflektierend, 3 = geteilter Schaden)
        set scr_friendlyfire "1"

        //KillCam
        set scr_killcam "1"

        //Freies Umsehen
        set scr_freelook "0"

        //Gegner im Zuschauer-Modus beobachten
        set scr_spectateenemy "0"

        //PK3-Dateien-Abgleich (0 = an, 1 = aus)
        //Wenn an mssen die pk3s des Servers und der Clients gleich sein!
        set sv_pure "0"

        //Automatischer Team-Ausgleich
        set scr_teambalance "1"

        //Cheats
        set sv_cheats "0"

        //Spam-Schutz
        set sv_floodprotect "1"

        //FPS des Servers
        set sv_fps "25"

        //Master-Server (wo der Server angemeldet werden soll)
        seta sv_master0 ""
        seta sv_master1 ""
        seta sv_master2 ""
        seta sv_master3 ""
        seta sv_master4 ""
        set g_gamespy "1"

        //Tote k?nen mit allen chatten 0 = aus, 1 = an
        set g_deadChat "1"

        //Konsolensperre fr Clients
        set sv_disableClientConsole "0"

        //Download erlauben
        set sv_allowDownload "1"

        //WWW Download erlauben
        set sv_wwwDownload "0"

        set sv_wwwBaseURL "http://example.com/"
        set sv_wwwDlDisconnected "0"
        set sv_reconnectlimit "3"
        set sv_dl_maxRate "150000" 

        //Voting erlauben
        set g_allowvote "1"

        //***

        //Waffen-Einstellungen:
        //(0 = verbieten, 1 = erlauben):

        //Scharfschuetzengewehre:
        set scr_allow_springfield "1"
        set scr_allow_svt40 "1"
        set scr_allow_kar98ksniper "1"
        set scr_allow_nagantsniper "1"
        set scr_allow_enfieldsniper "1"

        //Gewehre:
        set scr_allow_enfield "1"
        set scr_allow_kar98k "1"
        set scr_allow_m1carbine "1"
        set scr_allow_m1garand "1"
        set scr_allow_g43 "1"
        set scr_allow_nagant "1"

        //Schwere MG's:
        set scr_allow_bar "1"
        set scr_allow_bren "1"
        set scr_allow_mp44 "1"
        set scr_allow_ppsh "1"

        //Leichte MG's:
        set scr_allow_mp40 "1"
        set scr_allow_sten "1"
        set scr_allow_thompson "1"
        set scr_allow_pps42 "1"
        set scr_allow_greasegun "1"

        //Panzerfaust:
        set scr_allow_panzerfaust "1"

        //Granaten:
        set scr_allow_fraggrenades "1"

        //***

        //Spiel-Modi-Einstellungen:

        //DM (Death Match)

        //Punkte-Limit
        set scr_dm_scorelimit "50"

        //Zeit-Limit
        set scr_dm_timelimit "20"

        //TDM (Team Deathmatch)
        //Punkte-Limit
        set scr_tdm_scorelimit "100"

        //Zeit-Limit
        set scr_tdm_timelimit "20"

        //SD (Seach and Destroy)
        //Zeit bis Rundenstart (Sekunden)
        set scr_sd_graceperiod "15"

        //Rundenlaenge
        set scr_sd_roundlength "2.5"

        //Runden-Limit
        set scr_sd_roundlimit "8"

        //Punkte-Limit (Runden)
        set scr_sd_scorelimit "10"

        //Zeit-Limit
        set scr_sd_timelimit "20"

        //Zeit bis Explosion der Bombe in Sek.
        set scr_sd_bombtimer "60"

        //CTF (Retrival)
        //Punkte-Limit (Runden)
        set scr_re_scorelimit "10"

        //Zeit-Limit
        set scr_re_timelimit "20"
        set scr_re_roundlimit "10"
        set scr_re_roundlength "4"
        set scr_re_graceperiod "10"

        //HQ
        //Punkte-Limit
        set scr_hq_scorelimit "50"

        //Zeit-Limit
        set scr_hq_timelimit "20"

        //Start-Spiel-Modus
        set g_gametype "dm"

        set sv_mapRotation "gametype dm map mp_carentan gametype dm map mp_harbor gametype dm map mp_neuville gametype dm map mp_tigertown "

        set sv_mapRotationCurrentmap "mp_harbor"

        wait 250
        map_rotate
      dest: "{{ games_cod1_server_installed__directory }}/main/server.cfg"
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0644'
      backup: yes

  - name: Ensure config_mp.cfg file exists with specified content
    ansible.builtin.copy:
      content: |
        // generated by Call of Duty, do not modify
        unbindall
        bind TAB "+scores"
        bind ENTER "+mlook"
        bind ESCAPE "togglemenu"
        bind SPACE "+gostand"
        bind 1 "weaponslot primary"
        bind 2 "weaponslot primaryb"
        bind 3 "weaponslot pistol"
        bind 4 "weaponslot grenade"
        bind < "+movedown"
        bind ` "toggleconsole"
        bind A "+moveleft"
        bind B "toggleprone"
        bind C "togglecrouch"
        bind D "+moveright"
        bind E "+leanright"
        bind F "weapalt"
        bind H "exec name.cfg"
        bind M "weapalt"
        bind P "centerview"
        bind Q "+leanleft"
        bind R "+activate"
        bind S "+back"
        bind T "messagemode2"
        bind V "+movedown"
        bind W "+forward"
        bind X "toggleprone"
        bind Y "+reload"
        bind ~ "toggleconsole"
        bind 252 "+prone"
        bind PAUSE "toggle cl_paused"
        bind UPARROW "+lookup"
        bind DOWNARROW "+lookdown"
        bind LEFTARROW "+left"
        bind RIGHTARROW "+right"
        bind CTRL "goprone"
        bind SHIFT "+speed"
        bind INS "+strafe"
        bind F1 "vote yes"
        bind F2 "vote no"
        bind F4 "+scores"
        bind F12 "screenshotJPEG"
        bind KP_HOME "+moveup"
        bind KP_LEFTARROW "say ^2Is that the ^1Schoolbus ^2 Sprayer did it just stop here?"
        bind KP_RIGHTARROW "say ^2I should go playing ^1WoW ^2cause I got no ^1balls ^2n' stuff rite?"
        bind KP_END "say ^1Ana.Conda^1 ^2bites^2 ^3you^3"
        bind KP_ENTER "messagemode"
        bind KP_INS "mp_QuickMessage"
        bind KP_MINUS "messagemode2"
        bind MOUSE1 "+attack"
        bind MOUSE2 "toggle cl_run"
        bind MOUSE3 "+melee"
        bind MWHEELDOWN "weapprev"
        bind MWHEELUP "weapnext"
        seta b_antilag "1"
        seta cg_autodemo "0"
        seta cg_autoscreenshot "0"
        seta cg_blood "0"
        seta cg_brass "0"
        seta cg_chatHeight "8"
        seta cg_chatTime "12000"
        seta cg_cornoas "0"
        seta cg_crosshairAlpha "1.0"
        seta cg_crosshairAlphaMin "0.7"
        seta cg_crosshairDynamic "0"
        seta cg_crosshairNoGun "gfx/reticle/hud@center_ads.tga"
        seta cg_crosshairSize "48"
        seta cg_currentSelectedPlayer "0"
        seta cg_currentSelectedPlayerName ""
        seta cg_cursorHints "4"
        seta cg_deadbodyque "32"
        seta cg_descriptiveText "1"
        seta cg_drawCompass "1"
        seta cg_drawCrosshair "1"
        seta cg_drawCrosshairNames "1"
        seta cg_drawCrosshairPickups "1"
        seta cg_drawFPS "0"
        seta cg_drawGun "1"
        seta cg_drawNotifyText "1"
        seta cg_drawRewards "1"
        seta cg_drawSnapshot "0"
        seta cg_drawStatus "1"
        seta cg_drawTeamOverlay "2"
        seta cg_fov "80"
        seta cg_gameBoldMessageWidth "60"
        seta cg_gameMessageWidth "70"
        seta cg_gibs "0"
        seta cg_hintFadeTime "100"
        seta cg_hudAlpha "1.0"
        seta cg_hudCompassMaxRange "1024"
        seta cg_hudCompassMinRadius "0"
        seta cg_hudCompassMinRange "0"
        seta cg_hudCompassSize "1.0"
        seta cg_hudCompassSpringyPointers "0"
        seta cg_hudDamageIconHeight "64"
        seta cg_hudDamageIconInScope "0"
        seta cg_hudDamageIconOffset "32"
        seta cg_hudDamageIconTime "2000"
        seta cg_hudDamageIconWidth "128"
        seta cg_hudObjectiveMaxHeight "70"
        seta cg_hudObjectiveMaxRange "2048"
        seta cg_hudObjectiveMinAlpha "1"
        seta cg_hudObjectiveMinHeight "-70"
        seta cg_hudStanceHintPrints "1"
        seta cg_lagometer "0"
        seta cg_marks "1"
        seta cg_noPredict "0"
        seta cg_noTaunt "0"
        seta cg_noVoiceChats "0"
        seta cg_noVoiceText "0"
        seta cg_predictItems "1"
        seta cg_railTrailTime "400"
        seta cg_scoreboardScrollStep "3"
        seta cg_selectedPlayer "0"
        seta cg_shadows "0"
        seta cg_showdemoname "1"
        seta cg_stereoSeparation "0.4"
        seta cg_subtitleMinTime "3"
        seta cg_subtitles "1"
        seta cg_subtitleWidth "80"
        seta cg_teamChatsOnly "0"
        seta cg_viewsize "100"
        seta cg_voiceSpriteTime "6000"
        seta cg_weaponCycleDelay "0"
        seta cl_allowDownload "0"
        seta cl_anonymous "0"
        seta cl_freelook "1"
        seta cl_goStandJumpTime "0"
        seta cl_language "2"
        seta cl_maxpackets "30"
        seta cl_maxPing "800"
        seta cl_mouseAccel "0"
        seta cl_packetdup "1"
        seta cl_pitchspeed "140"
        seta cl_punkbuster "0"
        seta cl_timenudge "0"
        seta cl_wwwDownload "1"
        seta cl_xmodelcheck "0"
        seta cl_yawspeed "140"
        seta cm_playerCurveClip "1"
        seta com_hunkmegs "128"
        seta com_introplayed "1"
        seta com_maxfps "125"
        seta com_recommendedSet "1"
        seta con_debug "0"
        seta con_minicon "0"
        seta con_miniconlines "5"
        seta con_minicontime "4"
        seta g_allowvote "1"
        seta g_allowvoteclientkick "1"
        seta g_allowVoteDrawFriend "0"
        seta g_allowVoteFriendlyFire "1"
        seta g_allowvotegametype "1"
        seta g_allowvotekick "1"
        seta g_allowVoteKillCam "1"
        seta g_allowVoteMap "1"
        seta g_allowVoteMapRestart "1"
        seta g_allowVoteMapRotate "1"
        seta g_allowvotetempbanclient "0"
        seta g_allowvotetempbanuser "0"
        seta g_allowvotetypemap "1"
        seta g_autodemo "0"
        seta g_autoscreenshot "0"
        seta g_banIPs ""
        seta g_complaintlimit "3"
        seta g_deadChat "0"
        seta g_log "games_mp.log"
        seta g_logSync "0"
        seta g_timeoutBank "180000"
        seta g_timeoutlength "90000"
        seta g_timeoutRecovery "10000"
        seta g_timeoutsallowed "0"
        seta g_useGear "1"
        seta g_voiceChatsAllowed "4"
        seta handicap "100"
        seta head ""
        seta in_joyBallScale "0.02"
        seta in_joystick "0"
        seta in_midi "0"
        seta in_midichannel "1"
        seta in_mididevice "0"
        seta in_midiport "1"
        seta in_mouse "1"
        seta joy_threshold "0.15"
        seta m_filter "0"
        seta m_forward "0.25"
        seta m_pitch "0.022"
        seta m_side "0.25"
        seta m_yaw "0.022"
        seta model ""
        seta mss_3d_provider "Miles Fast 2D Positional Audio"
        seta mss_bits "16"
        seta mss_errorOnMissing "1"
        seta mss_khz "44"
        seta mss_stereo "1"
        seta mss_volume "0.260417"
        seta name "baereneule"
        seta net_noipx "0"
        seta net_noudp "0"
        seta net_socksEnabled "0"
        seta net_socksPassword ""
        seta net_socksPort "1080"
        seta net_socksServer ""
        seta net_socksUsername ""
        seta pb_sleep "60"
        seta pb_system "1"
        seta r_ati_fsaa_samples "1"
        seta r_ati_pntriangles "0"
        seta r_ati_truform_normalmode "QUADRATIC"
        seta r_ati_truform_pointmode "CUBIC"
        seta r_ati_truform_tess "1"
        seta r_colorbits "32"
        seta r_customaspect "1"
        seta r_customheight "1024"
        seta r_customwidth "1600"
        seta r_depthbits "0"
        seta r_detailtextures "1"
        seta r_diffuseSunQuality "2"
        seta r_diffuseSunSteps "3"
        seta r_displayrefresh "0"
        seta r_dlightQuality "0"
        seta r_drawSun "0"
        seta r_dynamiclight "1"
        seta r_entLightCutoff "0.2"
        seta r_ext_texture_filter_anisotropic "0"
        seta r_fastsky "0"
        seta r_finish "0"
        seta r_fullscreen "1"
        seta r_gamma "1.723958"
        seta r_ignoreGLErrors "1"
        seta r_ignorehwgamma "0"
        seta r_inGameVideo "1"
        seta r_lodbias "-100"
        seta r_lodscale "2"
        seta r_maxEntLights "8"
        seta r_mem_agp "1"
        seta r_mem_backend "1"
        seta r_mem_manual "0"
        seta r_mem_video "9"
        seta r_minEntLightIntensity "0.02"
        seta r_mode "8"
        seta r_nv_fog_dist "0"
        seta r_nv_fogdist_mode "GL_EYE_RADIAL_NV"
        seta r_overBrightBits "1"
        seta r_picmip "1"
        seta r_picmip2 "1"
        seta r_portalbevels "0.7"
        seta r_primitives "0"
        seta r_railCoreWidth "1"
        seta r_railSegmentLength "32"
        seta r_railWidth "16"
        seta r_simpleMipMaps "1"
        seta r_skip_auto_config "0"
        seta r_stencilbits "8"
        seta r_swapDelay "0"
        seta r_swapInterval "0"
        seta r_texturebits "0"
        seta r_textureMode "GL_LINEAR_MIPMAP_NEAREST"
        seta r_vbo_interleave "0"
        seta r_vbo_paranoia "1"
        seta r_vbo_smc_static_draw "1"
        seta r_vbo_stream_draw "0"
        seta rate "25000"
        seta scr_drawfriend "1"
        seta scr_friendlyfire "1"
        seta scr_killcam "1"
        seta sensitivity "5"
        seta server1 ""
        seta server10 ""
        seta server11 ""
        seta server12 ""
        seta server13 ""
        seta server14 ""
        seta server15 ""
        seta server16 ""
        seta server2 ""
        seta server3 ""
        seta server4 ""
        seta server5 ""
        seta server6 ""
        seta server7 ""
        seta server8 ""
        seta server9 ""
        seta snaps "40"
        seta sv_allowDownload "1"
        seta sv_floodProtect "1"
        seta sv_hostname "gamescomlan"
        seta sv_master2 ""
        seta sv_master3 ""
        seta sv_master4 ""
        seta sv_master5 ""
        seta sv_maxclients "20"
        seta sv_maxPing "0"
        seta sv_maxRate "0"
        seta sv_minPing "0"
        seta sv_punkbuster "0"
        seta sv_wwwBaseURL ""
        seta sv_wwwDlDisconnected "0"
        seta sv_wwwDownload "0"
        seta sys_configSum "76081222"
        seta ui_bigFont "0.4"
        seta ui_browserFriendlyfire "-1"
        seta ui_browserGameType "0"
        seta ui_browserKillcam "-1"
        seta ui_browserMaster "0"
        seta ui_browserMod "-1"
        seta ui_browserShowDedicated "0"
        seta ui_browserShowEmpty "1"
        seta ui_browserShowFull "1"
        seta ui_browserShowNoPassword "1"
        seta ui_browserShowPassword "1"
        seta ui_browserShowPunkBuster "-1"
        seta ui_browserShowPure "1"
        seta ui_browserSortKey "4"
        seta ui_browserTimeoutsAllowed "-1"
        seta ui_currentMap "6"
        seta ui_currentNetMap "6"
        seta ui_dedicated "0"
        seta ui_extraBigFont "0.55"
        seta ui_gametype "3"
        seta ui_joinGametype "0"
        seta ui_mapIndex "6"
        seta ui_netGametype "5"
        seta ui_netGametypeName "dm"
        seta ui_netSource "1"
        seta ui_serverStatusTimeOut "7000"
        seta ui_smallFont "0.25"
        seta vid_xpos "3"
        seta vid_ypos "22"
      dest: "{{ games_cod1_server_installed__directory }}/main/config_mp.cfg"
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0644'
      backup: yes

  - name: Ensure config_mp.cfg file exists in /home/cod1/.callofduty
    ansible.builtin.copy:
      src: /games/cod1/main/config_mp.cfg
      dest: /home/cod1/.callofduty/main/config_mp.cfg
      owner: "{{ games_cod1_server_installed__user_name }}"
      group: "{{ games_cod1_server_installed__group_name }}"
      mode: '0644'
      backup: yes

  - name: Create systemd service file for CoD1
    ansible.builtin.copy:
      dest: /etc/systemd/system/cod1.service
      content: |
        [Unit]
        Description=Call of Duty 1 Dedicated Server
        After=network.target

        [Service]
        User={{ games_cod1_server_installed__user_name }}
        Group={{ games_cod1_server_installed__group_name }}
        WorkingDirectory={{ games_cod1_server_installed__directory }}
        Environment="LD_LIBRARY_PATH=/lib:{{ games_cod1_server_installed__directory }}"
        ExecStart={{ games_cod1_server_installed__directory }}/cod_lnxded +set dedicated 2 +set net_port {{ games_cod1_server_installed__port }} +set fs_basepath /games/cod1/ +exec server.cfg +map mp_harbor +set ttycon 0
        Restart=on-failure
        Type=simple
        KillMode=process

        [Install]
        WantedBy=multi-user.target
      owner: root
      group: root
      mode: '0644'

  - name: Reload systemd daemon
    systemd:
      daemon_reload: yes

  - name: Enable CoD1 service
    systemd:
      name: cod1
      enabled: yes
